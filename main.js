(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{ep:()=>D,OP:()=>J,QQ:()=>N,IM:()=>I,O9:()=>U,AO:()=>B,xZ:()=>h,Gs:()=>p,Y7:()=>y,J$:()=>g,IW:()=>C,qq:()=>b,Hf:()=>T,TI:()=>j,te:()=>P,$P:()=>M,vc:()=>H,DW:()=>w,v1:()=>A,Qk:()=>k,IP:()=>x});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"dea51c55-7adb-49f1-89d1-5eb5c7c9ebf0","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))},a=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))};function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",s)}function i(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",s)}function s(e){"Escape"===e.key&&i(document.querySelector(".popup_opened"))}function u(e){return e?"Сохранение...":"Сохранить"}var l="";function d(e){var t=function(e,t){var n=J.querySelector(".card").cloneNode(!0),i=n.querySelector(".card__image"),s=e.likes,u=n.querySelector(".card__like-count");return i.setAttribute("src",e.link),i.setAttribute("alt",e.name),n.querySelector(".card__title").textContent=e.name,u.textContent=s.length,n.querySelector(".card__like-btn").addEventListener("click",(function(t){!function(e,t,n){t.classList.contains("card__like-btn_active")?(t.classList.remove("card__like-btn_active"),o(e).then((function(e){n.textContent=e.likes.length})).catch((function(e){console.log(e)}))):(t.classList.add("card__like-btn_active"),a(e).then((function(e){n.textContent=e.likes.length})).catch((function(e){console.log(e)})))}(e._id,t.target,u)})),i.addEventListener("click",(function(){var t,n;t=e.link,n=e.name,C.setAttribute("src",""),C.setAttribute("alt",""),C.setAttribute("src",t),C.setAttribute("alt",n),g.textContent=n,c(y)})),t._id!==l?n.querySelector(".card__trash-btn").classList.add("card__trash-btn_hidden"):n.querySelector(".card__trash-btn").addEventListener("click",(function(){r(e._id).then((function(){n.remove()})).catch((function(e){console.log(e)}))})),n}(e,e.owner);D.prepend(t)}var f,v=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(e.inactiveButtonClass)):(n.disabled=!0,n.classList.add(e.inactiveButtonClass))},_=document.querySelector(".page"),m=_.querySelector(".userbox"),p=_.querySelector(".popup_edit"),h=_.querySelector(".popup_add"),y=_.querySelector(".popup_img"),b=_.querySelector(".popup_update-avatar"),S=_.querySelectorAll(".popup"),q=m.querySelector(".userbox__edit-btn"),L=m.querySelector(".userbox__add-btn"),E=m.querySelector(".userbox__avatar-container"),C=y.querySelector(".popup__img-item"),g=y.querySelector(".popup__caption-img"),k=m.querySelector(".userbox__name"),x=m.querySelector(".userbox__status"),A=m.querySelector(".userbox__avatar"),O=document.forms["edit-form"],P=O.querySelector(".form__btn"),U=O.username,T=O.status,D=_.querySelector(".cards"),J=document.querySelector("#card-template").content,N=document.forms["add-form"],j=N.querySelector(".form__btn"),B=N.placename,w=N["url-place"],I=document.forms["update_avatar-form"],M=I.querySelector(".form__btn"),H=I["url-avatar"];q.addEventListener("click",(function(){U.value=k.textContent,T.value=x.textContent,c(p)})),L.addEventListener("click",(function(){c(h)})),E.addEventListener("click",(function(){c(b)})),S.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target;(t.classList.contains("popup")||t.classList.contains("popup__close-btn"))&&S.forEach((function(e){e.classList.contains("popup_opened")&&i(e)}))}))})),O.addEventListener("submit",(function(e){var r,o;e.preventDefault(),P.value=u(!0),(r=U.value,o=T.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then((function(e){return n(e)}))).then((function(e){k.textContent=e.name,x.textContent=e.about,i(p)})).catch((function(e){console.log(e)})).finally((function(){P.value=u(!1)}))})),N.addEventListener("submit",(function(e){e.preventDefault();var r,o,a=B.value,c=w.value;j.value=u(!0),(r=a,o=c,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then((function(e){return n(e)}))).then((function(e){d(e),i(h)})).catch((function(e){console.log(e)})).finally((function(){j.value=u(!1)})),N.reset(),j.disabled=!0})),I.addEventListener("submit",(function(e){e.preventDefault();var r=H.value;M.value=u(!0),function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(e){return n(e)}))}(r).then((function(e){A.src=e.avatar,i(b)})).catch((function(e){console.log(e)})).finally((function(){M.value=u(!1)})),I.reset(),M.disabled=!0})),f={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__btn",inactiveButtonClass:"form__btn_state_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(f.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);v(e,n,r),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,o),v(e,n,r)}))}))}(f,e)})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return n(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return n(e)}))]).then((function(e){var t;k.textContent=e[0].name,x.textContent=e[0].about,A.src=e[0].avatar,t=e[0],l=t._id,e[1].forEach((function(e){d(e)}))})).catch((function(e){console.log(e)}))})();